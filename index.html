    <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalWork Pro | Ultimate V18</title>
    <style>
        @font-face { font-family: 'Digital'; src: url('https://fonts.cdnfonts.com/s/14234/DS-DIGI.woff') format('woff'); }
        :root { --primary: #00d2ff; --bg: #000; --card: #121212; --success: #2ecc71; --danger: #ff4b2b; --glow: #39FF14; --selection: rgba(0, 210, 255, 0.3); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; height: 100vh; }

        /* 1. Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #splash { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        <div id="activationOverlay">
    <div class="act-box">
        <h2 style="color:var(--primary); margin:0">ØªÙ†Ø´ÙŠØ· Ø§Ù„Ù†Ø³Ø®Ø©</h2>
        <p style="color:#666; font-size: 13px; margin-top: 10px;">Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±</p>
        <input type="text" id="activationKeyInput" class="act-input" placeholder="0000">
        <button class="act-btn" onclick="checkActivation()">ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø¢Ù†</button>
        <p id="actError" style="color:var(--danger); margin-top:15px; display:none; font-size:12px">âŒ ÙƒÙˆØ¯ Ø§Ù„ØªÙ†Ø´ÙŠØ· ØºÙŠØ± ØµØ­ÙŠØ­</p>
    </div>
</div>
        #splash h1 { color: var(--primary); font-size: 2.5rem; text-shadow: 0 0 20px var(--primary); margin: 10px 0; }
        #splash .dev { color: #555; font-size: 0.9rem; letter-spacing: 2px; }

        /* 2. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (ØªØ±Ø³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª) */
        .settings-icon { position: absolute; top: 20px; left: 20px; font-size: 26px; color: #555; z-index: 2000; cursor: pointer; }
        .side-menu { position: fixed; top: -100%; left: 0; width: 100%; background: var(--card); transition: 0.5s; padding: 25px; z-index: 3000; border-bottom: 2px solid var(--primary); border-radius: 0 0 25px 25px; box-sizing: border-box; }
        .side-menu.active { top: 0; }

        /* 3. Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„Ø¹Ù‚Ø§Ø±Ø¨ */
        .clock-container { position: relative; width: 210px; height: 210px; margin-top: 20px; border-radius: 50%; border: 2px solid #222; background: radial-gradient(circle, #0a0a0a 0%, #000 100%); }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; border-radius: 10px; }
        .hour-hand { width: 6px; height: 45px; background: #fff; z-index: 10; }
        .min-hand { width: 4px; height: 70px; background: var(--glow); z-index: 11; box-shadow: 0 0 10px var(--glow); }
        .sec-hand { width: 2px; height: 80px; background: var(--danger); z-index: 12; }
        .clock-num { position: absolute; width: 100%; height: 100%; text-align: center; font-weight: bold; font-size: 16px; color: var(--primary); text-shadow: 0 0 8px var(--primary); padding: 5px; box-sizing: border-box; }

        /* 4. Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ù…Ù‚Ø·Ø¹ */
        #work-timer { font-family: 'Digital', sans-serif; font-size: 4rem; color: var(--primary); margin: 15px 0; text-shadow: 0 0 15px rgba(0, 210, 255, 0.5); }

        /* 5. Ø§Ù„Ù†ÙˆØ§ÙØ° ÙˆØ§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.97); display: none; justify-content: center; align-items: center; z-index: 4000; }
        .modal-box { background: var(--card); border: 1px solid #333; border-radius: 25px; padding: 20px; width: 90%; max-height: 90%; overflow-y: auto; text-align: center; }
        .num-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 15px; }
        .num-btn { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 18px; border-radius: 15px; font-size: 1.4rem; font-weight: bold; }

        /* 6. Ø§Ù„ØªÙ‚ÙˆÙŠÙ… */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; }
        .day-btn { background: #1a1a1a; border: 1px solid #333; padding: 12px 0; border-radius: 10px; font-size: 12px; color: #fff; position: relative; }
        .day-btn.has-data { border-color: var(--success); }
        .day-btn.selected { background: var(--selection); border-color: var(--primary); }

        /* 7. Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: #1a1a1a; border: 1px solid var(--primary); padding: 12px 25px; border-radius: 50px; z-index: 5000; transition: 0.5s; }
        #toast.show { bottom: 30px; }
        /* ØªØµÙ…ÙŠÙ… Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
.pass-line { display: flex; justify-content: space-between; align-items: center; background: #000; padding: 12px 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #222; }
.pass-line.active { border-color: var(--primary); box-shadow: 0 0 10px rgba(0,210,255,0.2); }
.stars { color: var(--primary); font-size: 1.4rem; letter-spacing: 5px; font-weight: bold; min-height: 24px; }
.pass-label { color: #888; font-size: 0.8rem; text-transform: uppercase; }
        /* ØªØµÙ…ÙŠÙ… Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ */
#activationOverlay { position: fixed; inset: 0; background: #000; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; padding: 20px; }
.act-box { background: var(--card); border: 1px solid var(--primary); padding: 30px; border-radius: 25px; width: 85%; text-align: center; box-shadow: 0 0 20px rgba(0,210,255,0.2); }
.act-input { background: #000; border: 1px solid #333; color: var(--primary); padding: 15px; border-radius: 12px; width: 100%; margin: 20px 0; text-align: center; font-size: 1.5rem; letter-spacing: 5px; box-sizing: border-box; }
.act-btn { background: var(--primary); color: #000; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; }
    </style>
</head>
<body onload="initApp()">

    <div id="splash">
        <div class="dev">BUILD V18</div>
        <h1>CalWork Pro</h1>
        <div class="dev">DEVELOPED BY ENG. AYMAN</div>
    </div>

    <div class="settings-icon" onclick="toggleMenu()">âš™ï¸</div>

    <div id="sideMenu" class="side-menu">
        <div onclick="openCalendar()" style="padding:15px; border-bottom:1px solid #222">ğŸ“… Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ø¯ÙˆØ±Ø© 26)</div>
        <div onclick="openPassModal()" style="padding:15px; border-bottom:1px solid #222">ğŸ”’ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
        <input type="email" id="targetEmail" onchange="saveEmail(this.value)" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" style="width:100%; background:#000; color:#fff; padding:10px; margin:10px 0; border-radius:8px; border:1px solid #333; text-align:center">
        <div style="border-top:1px solid #333; margin-top:10px; padding-top:10px; padding: 0 15px;">
    <label style="font-size:11px; color:var(--primary); display:block; margin-bottom:5px; text-align:right;">ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
    <input type="text" id="masterKeyInput" onchange="updateActivationKey(this.value)" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§" 
    style="width:100%; background:#000; color:#fff; padding:10px; border-radius:8px; border:1px dashed var(--primary); text-align:center; box-sizing: border-box;">
</div>
        <div onclick="toggleMenu()" style="padding:15px; color:var(--danger)">âœ• Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
    </div>

    <div class="clock-container" id="analogClock">
        <div id="hour" class="hand hour-hand"></div>
        <div id="min" class="hand min-hand"></div>
        <div id="sec" class="hand sec-hand"></div>
        <div style="position:absolute; top:50%; left:50%; width:8px; height:8px; background:#fff; border-radius:50%; transform:translate(-50%,-50%); z-index:13"></div>
    </div>

    <div id="work-timer">00:00:00</div>

    <div id="status-display" style="width:85%; opacity:0; transition:0.5s; background:rgba(255,255,255,0.03); border-radius:15px; padding:12px; border:1px dashed #444">
        <div style="display:flex; justify-content:space-between"><span id="in-time" style="color:var(--glow); font-weight:bold">--:--</span><span>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</span></div>
        <div id="out-row" style="display:none; justify-content:space-between; margin-top:8px"><span id="out-time" style="color:var(--danger); font-weight:bold">--:--</span><span>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</span></div>
    </div>

    <div class="controls" style="display:flex; gap:30px; margin-top:auto; padding-bottom:40px">
        <button id="inBtn" style="width:90px; height:90px; border-radius:50%; border:none; background:var(--success); color:#fff; font-weight:bold" onclick="askPIN('in')">IN</button>
        <button id="outBtn" style="width:90px; height:90px; border-radius:50%; border:none; background:var(--danger); color:#fff; font-weight:bold; opacity:0.3" onclick="askPIN('out')">OUT</button>
    </div>
<div id="passOverlay" class="overlay">
    <div class="modal-box">
        <h3 style="color:var(--primary); margin-bottom:20px">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
        <div class="pass-line" id="l1"><span class="pass-label">Old Pass</span><div id="s1" class="stars"></div></div>
        <div class="pass-line" id="l2"><span class="pass-label">New Pass</span><div id="s2" class="stars"></div></div>
        <div class="pass-line" id="l3"><span class="pass-label">Confirm</span><div id="s3" class="stars"></div></div>
        <div class="num-pad">
            <button class="num-btn" onclick="pNum(1)">1</button><button class="num-btn" onclick="pNum(2)">2</button><button class="num-btn" onclick="pNum(3)">3</button>
            <button class="num-btn" onclick="pNum(4)">4</button><button class="num-btn" onclick="pNum(5)">5</button><button class="num-btn" onclick="pNum(6)">6</button>
            <button class="num-btn" onclick="pNum(7)">7</button><button class="num-btn" onclick="pNum(8)">8</button><button class="num-btn" onclick="pNum(9)">9</button>
            <button class="num-btn" onclick="closePass()">âœ•</button><button class="num-btn" onclick="pNum(0)">0</button><button class="num-btn" onclick="clearPass()">âŒ«</button>
        </div>
    </div>
</div>
    <div id="pinOverlay" class="overlay"><div class="modal-box">
        <h3>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h3>
        <div style="display:flex; justify-content:center; gap:10px; margin:20px 0">
            <div class="p-dot" style="width:15px; height:15px; border-radius:50%; border:2px solid var(--primary)"></div>
            <div class="p-dot" style="width:15px; height:15px; border-radius:50%; border:2px solid var(--primary)"></div>
            <div class="p-dot" style="width:15px; height:15px; border-radius:50%; border:2px solid var(--primary)"></div>
            <div class="p-dot" style="width:15px; height:15px; border-radius:50%; border:2px solid var(--primary)"></div>
        </div>
        <div class="num-pad">
            <button class="num-btn" onclick="pressNum(1)">1</button><button class="num-btn" onclick="pressNum(2)">2</button><button class="num-btn" onclick="pressNum(3)">3</button>
            <button class="num-btn" onclick="pressNum(4)">4</button><button class="num-btn" onclick="pressNum(5)">5</button><button class="num-btn" onclick="pressNum(6)">6</button>
            <button class="num-btn" onclick="pressNum(7)">7</button><button class="num-btn" onclick="pressNum(8)">8</button><button class="num-btn" onclick="pressNum(9)">9</button>
            <button class="num-btn" onclick="closeModals()">âœ•</button><button class="num-btn" onclick="pressNum(0)">0</button><button class="num-btn" onclick="clearPIN()">âŒ«</button>
        </div>
    </div></div>

    <div id="logOverlay" class="overlay"><div class="modal-box">
        <h3 style="margin:0">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ</h3>
        <div id="calHeader" style="color:var(--primary); margin:10px 0; font-weight:bold"></div>
        <div class="calendar-grid" id="grid"></div>
        <div id="dayInfo" style="margin-top:15px; color:#aaa; font-size:14px">Ø§Ø¶ØºØ· ÙŠÙˆÙ… Ù„Ù„ØªÙØ§ØµÙŠÙ„</div>
        <div id="rangeRes"></div>
        <button onclick="closeModals()" style="width:100%; padding:15px; background:var(--danger); border:none; color:#fff; border-radius:15px; margin-top:15px">Ø¥ØºÙ„Ø§Ù‚</button>
    </div></div>

    <div id="toast">âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</div>

    <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyvmKQlFFEr5vkGe3GLCmAADIJRcGVnXWimP3NSQgNZ35SPaDzr91BV-JeJPicO0FVw/exec';
    let timer, seconds=0, currentPIN="", targetAction="", appPass=localStorage.getItem('appPass')||"1234", logs=JSON.parse(localStorage.getItem('calwork_db'))||{};
    let pStep=1, t1="", t2="", t3="", selDays=[];

    function initApp() {
    // 1. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹
    if (!localStorage.getItem('isActivated')) {
        document.getElementById('splash').style.display = 'none';
        document.getElementById('activationOverlay').style.display = 'flex';
        return; // Ø¨ÙŠÙˆÙ‚Ù ØªØ´ØºÙŠÙ„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„Ùˆ Ù…Ø´ Ù…ØªÙØ¹Ù„
    }

    // 2. ÙƒÙˆØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ (Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©)
    createClockNumbers();
    setInterval(updateClock, 1000);
    document.getElementById('targetEmail').value = localStorage.getItem('targetEmail') || "";
    document.getElementById('masterKeyInput').value = currentActivationKey;

    const savedInTime = localStorage.getItem('isWorkingTime');
    if (savedInTime) {
        window.entryTime = new Date(savedInTime);
        const now = new Date();
        seconds = Math.floor((now - window.entryTime) / 1000);
        document.getElementById('in-time').innerText = window.entryTime.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        document.getElementById('status-display').style.opacity='1';
        document.getElementById('inBtn').style.opacity='0.3'; document.getElementById('outBtn').style.opacity='1';
        timer = setInterval(updateWorkTimer, 1000);
    }
    setTimeout(() => { document.getElementById('splash').style.display='none'; }, 2500);
}

// ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„
function checkActivation() {
    const userInput = document.getElementById('activationKeyInput').value;
    // Ø¨ÙŠÙ‚Ø§Ø±Ù† Ø§Ù„Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØªØ¨Ù‡ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ø¥Ù†Øª Ø­Ø¯Ø¯ØªÙ‡ ÙÙŠ Ø§Ù„Ù€ masterActivationKey
    if (userInput === currentActivationKey) {
        localStorage.setItem('isActivated', 'true');
        showToast("âœ… ØªÙ… Ø§Ù„ØªÙ†Ø´ÙŠØ· Ø¨Ù†Ø¬Ø§Ø­");
        location.reload(); // Ø¨ÙŠØ¹ÙŠØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ø´Ø§Ù† ÙŠÙØªØ­ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
    } else {
        document.getElementById('actError').style.display = 'block';
        setTimeout(() => { document.getElementById('actError').style.display = 'none'; }, 3000);
    }
}
    function createClockNumbers() {
        const container = document.getElementById('analogClock');
        for(let i=1; i<=12; i++) {
            let div = document.createElement('div');
            div.className = 'clock-num';
            div.innerText = i;
            div.style.transform = `rotate(${i * 30}deg)`;
            container.appendChild(div);
        }
    }

    function updateClock() {
        const n = new Date();
        const h=n.getHours()%12, m=n.getMinutes(), s=n.getSeconds();
        document.getElementById('hour').style.transform=`translateX(-50%) rotate(${h*30+m*0.5}deg)`;
        document.getElementById('min').style.transform=`translateX(-50%) rotate(${m*6}deg)`;
        document.getElementById('sec').style.transform=`translateX(-50%) rotate(${s*6}deg)`;
    }

    function showToast(m) { const t=document.getElementById('toast'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); }
    function askPIN(a) { targetAction=a; document.getElementById('pinOverlay').style.display='flex'; }
    function pressNum(n) { if(currentPIN.length<4){ currentPIN+=n; updateDots(); if(currentPIN.length==4) checkPIN(); } }
    function updateDots() { document.querySelectorAll('.p-dot').forEach((d,i)=>d.style.background=i<currentPIN.length? 'var(--primary)':'none'); }

    // Ù‡Ù†Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ ÙˆØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ }
    function checkPIN() { 
        if(currentPIN === appPass) { 
            closeModals(); 
            targetAction === 'in' ? startWork() : stopWork(); 
        } else { 
            showToast("âŒ PIN Ø®Ø·Ø£"); 
            currentPIN = ""; 
            updateDots(); 
        }
    }

    function startWork() {
    window.entryTime = new Date();
    // Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©
    localStorage.setItem('isWorkingTime', window.entryTime);
    
    document.getElementById('in-time').innerText = window.entryTime.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    document.getElementById('status-display').style.opacity='1';
    document.getElementById('inBtn').style.opacity='0.3'; 
    document.getElementById('outBtn').style.opacity='1';
    
    seconds = 0;
    timer = setInterval(updateWorkTimer, 1000);
}

// ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
function updateWorkTimer() {
    seconds++; 
    let h=Math.floor(seconds/3600).toString().padStart(2,'0'), 
        m=Math.floor((seconds%3600)/60).toString().padStart(2,'0'), 
        s=(seconds%60).toString().padStart(2,'0'); 
    document.getElementById('work-timer').innerText=`${h}:${m}:${s}`;
}

    function stopWork() {
        clearInterval(timer); const now = new Date();
        document.getElementById('out-time').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        document.getElementById('out-row').style.display='flex';
        let t=(seconds/3600).toFixed(2), b=t>8?8:t, e=t>8?(t-8).toFixed(2):"0.00";
        const entry = { date: now.toLocaleDateString('en-GB'), in: window.entryTime.toLocaleTimeString('en-GB'), out: now.toLocaleTimeString('en-GB'), total: t, basic: b, extra: e };
        logs[`${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`] = entry;
        localStorage.setItem('calwork_db', JSON.stringify(logs));
        if(navigator.onLine) fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', body:JSON.stringify({...entry, email:localStorage.getItem('targetEmail')})});
        showToast("âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹");
        setTimeout(() => { document.getElementById('status-display').style.opacity='0'; document.getElementById('work-timer').innerText="00:00:00"; document.getElementById('inBtn').style.opacity='1'; document.getElementById('outBtn').style.opacity='0.3'; seconds=0; }, 10000);
    }

    function openPassModal() { toggleMenu(); document.getElementById('passOverlay').style.display='flex'; pStep=1; clearPass(); }
    function pNum(n) {
        if(pStep==1 && t1.length<4) t1+=n;
        else if(pStep==2 && t2.length<4) t2+=n;
        else if(pStep==3 && t3.length<4) t3+=n;
        if(t1.length==4 && pStep==1) pStep=2;
        if(t2.length==4 && pStep==2) pStep=3;
        if(t3.length==4 && pStep==3) finishPass();
        updatePassUI();
    }
    function updatePassUI() {
        document.getElementById('s1').innerText = "*".repeat(t1.length);
        document.getElementById('s2').innerText = "*".repeat(t2.length);
        document.getElementById('s3').innerText = "*".repeat(t3.length);
        document.getElementById('l1').className = pStep==1?'pass-line active':'pass-line';
        document.getElementById('l2').className = pStep==2?'pass-line active':'pass-line';
        document.getElementById('l3').className = pStep==3?'pass-line active':'pass-line';
    }
    function finishPass() {
        if(t1 !== appPass) { showToast("âŒ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø®Ø·Ø£"); clearPass(); }
        else if(t2 !== t3) { showToast("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ·Ø§Ø¨Ù‚"); t2=""; t3=""; pStep=2; }
        else { localStorage.setItem('appPass', t2); appPass=t2; showToast("âœ… ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±"); closePass(); }
        updatePassUI();
    }
    function clearPass() { t1=""; t2=""; t3=""; pStep=1; updatePassUI(); }
    function closePass() { document.getElementById('passOverlay').style.display='none'; }

    function openCalendar() { toggleMenu(); document.getElementById('logOverlay').style.display='flex'; renderCycle(); }
    
    function renderCycle() {
        const grid = document.getElementById('grid'); grid.innerHTML = "";
        const now = new Date();
        const todayKey = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;
        const months = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø¥Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
        document.getElementById('calHeader').innerText = `${months[now.getMonth()]} ${now.getFullYear()}`;
        
        let start = new Date(now.getFullYear(), now.getMonth()-1, 26);
        let end = new Date(now.getFullYear(), now.getMonth(), 26);

        const todayData = logs[todayKey];
        document.getElementById('dayInfo').innerHTML = todayData ? 
            `<b style="color:#00d2ff">Ø§Ù„ÙŠÙˆÙ…:</b> ${todayData.in} - ${todayData.out} (${todayData.total} Ø³)` : 
            `<b style="color:#888">Ø§Ù„ÙŠÙˆÙ…:</b> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„`;

        for(let d = new Date(start); d <= end; d.setDate(d.getDate()+1)) {
            let key = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
            const btn = document.createElement('div');
            let isToday = (key === todayKey);
            btn.className = `day-btn ${logs[key] ? 'has-data' : ''} ${selDays.includes(key) ? 'selected' : ''}`;
            
            if (isToday) {
                btn.style.border = "2px solid #00d2ff";
                btn.style.boxShadow = "0 0 8px #00d2ff";
            }

            btn.innerText = d.getDate();
            btn.onclick = () => {
                const dLog = logs[key];
                document.getElementById('dayInfo').innerHTML = dLog ? 
                    `Ø­Ø¶ÙˆØ±: ${dLog.in} | Ø§Ù†ØµØ±Ø§Ù: ${dLog.out} | Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${dLog.total} Ø³` : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";
            };

            let hold; 
            btn.onmousedown = btn.ontouchstart = () => hold = setTimeout(() => {
                if(selDays.length>=2) selDays=[]; 
                selDays.push(key); 
                selDays.sort((a,b)=>new Date(a)-new Date(b));
                renderCycle();
                if(selDays.length==2) {
                    let b=0, e=0;
                    for(let k in logs) { 
                        if(new Date(k)>=new Date(selDays[0]) && new Date(k)<=new Date(selDays[1])) { 
                            b+=parseFloat(logs[k].basic); e+=parseFloat(logs[k].extra); 
                        } 
                    }
                    document.getElementById('rangeRes').innerHTML = `Ø£Ø³Ø§Ø³ÙŠ: ${b.toFixed(2)} | Ø¥Ø¶Ø§ÙÙŠ: ${e.toFixed(2)}`;
                }
            }, 800);
            btn.onmouseup = btn.ontouchend = () => clearTimeout(hold);
            grid.appendChild(btn);
        }
    }

    function saveEmail(v) { localStorage.setItem('targetEmail', v); showToast("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸"); }
    function closeModals() { 
        document.querySelectorAll('.overlay').forEach(o=>o.style.display='none'); 
        currentPIN=""; selDays=[]; 
        if(typeof clearPass === "function") clearPass();
        // 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 2026)
let currentActivationKey = localStorage.getItem('masterActivationKey') || "2026";

// 2. ÙˆØ¸ÙŠÙØ© Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù…Ø§ ØªÙƒØªØ¨Ù‡
function updateActivationKey(newKey) {
    if(newKey.trim() !== "") {
        localStorage.setItem('masterActivationKey', newKey);
        currentActivationKey = newKey;
        showToast("âš ï¸ ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ " + newKey + " ÙƒÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ Ø¬Ø¯ÙŠØ¯");
    }
}
    }
    </script>
</body>
</html>










