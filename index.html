<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalWork Pro | V14 Ultimate</title>
    <style>
        @font-face { font-family: 'Digital'; src: url('https://fonts.cdnfonts.com/s/14234/DS-DIGI.woff') format('woff'); }
        :root { --primary: #00d2ff; --bg: #000; --card: #121212; --success: #2ecc71; --danger: #ff4b2b; --glow: #39FF14; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; height: 100vh; }

        /* Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„ÙØ³ÙÙˆØ±ÙŠ */
        .clock-container { position: relative; width: 200px; height: 200px; margin-top: 20px; border-radius: 50%; border: 3px solid #111; box-shadow: 0 0 15px rgba(0, 210, 255, 0.2); background: radial-gradient(circle, #0a0a0a 0%, #000 100%); }
        .clock-container::before { content: ''; position: absolute; inset: -5px; border-radius: 50%; border: 2px solid var(--primary); opacity: 0.2; filter: blur(2px); }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; border-radius: 10px; }
        .hour-hand { width: 6px; height: 45px; background: #fff; z-index: 10; }
        .min-hand { width: 4px; height: 65px; background: var(--glow); z-index: 11; box-shadow: 0 0 10px var(--glow); }
        .sec-hand { width: 2px; height: 75px; background: var(--danger); z-index: 12; }
        .center-dot { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; background: #fff; border-radius: 50%; transform: translate(-50%, -50%); z-index: 13; }
        .number { position: absolute; font-size: 16px; font-weight: bold; color: #fff; transform: translate(-50%, -50%); }

        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ù…Ù‚Ø·Ø¹ */
        #work-timer { font-family: 'Digital', sans-serif; font-size: 4rem; color: var(--primary); margin: 20px 0; text-shadow: 0 0 15px rgba(0, 210, 255, 0.5); letter-spacing: 3px; }

        /* Ø¨ÙˆÙƒØ³ Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù */
        #status-display { width: 85%; height: 70px; display: flex; flex-direction: column; justify-content: center; opacity: 0; transition: 0.5s; background: rgba(255,255,255,0.03); border-radius: 15px; padding: 10px; border: 1px dashed #333; }
        .status-row { display: flex; justify-content: space-between; padding: 5px 10px; }
        .status-time { color: var(--glow); font-weight: bold; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .controls { display: flex; gap: 30px; margin-top: auto; padding-bottom: 40px; }
        .circle-btn { width: 85px; height: 85px; border-radius: 50%; border: none; color: #fff; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.4); }
        .settings-icon { position: absolute; top: 20px; left: 20px; font-size: 24px; color: #555; cursor: pointer; z-index: 2000; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ù†ÙˆØ§ÙØ° */
        .menu { position: fixed; top: -100%; left: 0; width: 100%; background: var(--card); transition: 0.5s; padding: 25px; z-index: 3000; border-bottom: 2px solid var(--primary); border-radius: 0 0 25px 25px; }
        .menu.active { top: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 4000; }
        .modal-box { background: var(--card); border: 1px solid #333; border-radius: 25px; padding: 20px; width: 85%; text-align: center; }
        
        /* PIN Pad */
        .num-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .num-btn { background: #1a1a1a; border: none; color: #fff; padding: 15px; border-radius: 12px; font-size: 1.2rem; }
        .pin-dot { width: 12px; height: 12px; border-radius: 50%; border: 2px solid var(--primary); display: inline-block; margin: 0 5px; }
        .pin-dot.active { background: var(--primary); }
    </style>
</head>
<body onload="initApp()">

    <div class="settings-icon" onclick="toggleMenu()">âš™ï¸</div>

    <div id="settingsMenu" class="menu">
        <div onclick="openCalendar()" style="padding:15px; border-bottom:1px solid #222">ğŸ“… Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</div>
        <div onclick="changePass()" style="padding:15px; border-bottom:1px solid #222">ğŸ”’ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
        <input type="email" id="targetEmail" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" onchange="saveEmail(this.value)" style="background:#111; border:1px solid #333; color:#fff; width:100%; padding:10px; margin:10px 0; border-radius:8px">
        <div onclick="toggleMenu()" style="padding:15px; color:var(--danger)">âœ• Ø¥ØºÙ„Ø§Ù‚</div>
    </div>

    <div class="clock-container">
        <div id="hour" class="hand hour-hand"></div>
        <div id="min" class="hand min-hand"></div>
        <div id="sec" class="hand sec-hand"></div>
        <div class="center-dot"></div>
        <div class="number" style="top:10%; left:50%">12</div>
        <div class="number" style="top:50%; left:90%">3</div>
        <div class="number" style="top:90%; left:50%">6</div>
        <div class="number" style="top:50%; left:10%">9</div>
    </div>

    <div id="work-timer">00:00:00</div>

    <div id="status-display">
        <div class="status-row">
            <span class="status-time" id="in-time">--:--</span>
            <span>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</span>
        </div>
        <div id="out-row" class="status-row" style="display:none">
            <span class="status-time" id="out-time">--:--</span>
            <span>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</span>
        </div>
    </div>

    <div class="controls">
        <button id="inBtn" class="circle-btn" style="background:var(--success)" onclick="askPIN('in')">CHECK IN</button>
        <button id="outBtn" class="circle-btn" style="background:var(--danger); opacity:0.3" onclick="askPIN('out')">CHECK OUT</button>
    </div>

    <div id="pinOverlay" class="overlay"><div class="modal-box">
        <h3>Ø§Ø¯Ø®Ù„ Ø±Ù…Ø² PIN</h3>
        <div id="pinDots"><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div></div>
        <div class="num-pad">
            <button class="num-btn" onclick="pressNum(1)">1</button><button class="num-btn" onclick="pressNum(2)">2</button><button class="num-btn" onclick="pressNum(3)">3</button>
            <button class="num-btn" onclick="pressNum(4)">4</button><button class="num-btn" onclick="pressNum(5)">5</button><button class="num-btn" onclick="pressNum(6)">6</button>
            <button class="num-btn" onclick="pressNum(7)">7</button><button class="num-btn" onclick="pressNum(8)">8</button><button class="num-btn" onclick="pressNum(9)">9</button>
            <button class="num-btn" onclick="closePIN()">âœ•</button><button class="num-btn" onclick="pressNum(0)">0</button><button class="num-btn" onclick="clearPIN()">âŒ«</button>
        </div>
    </div></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyvmKQlFFEr5vkGe3GLCmAADIJRcGVnXWimP3NSQgNZ35SPaDzr91BV-JeJPicO0FVw/exec';
        let timer, seconds = 0, currentPIN = "", targetAction = "";
        let appPass = localStorage.getItem('appPass') || "1234";
        let logs = JSON.parse(localStorage.getItem('calwork_db')) || {};

        function initApp() {
            setInterval(updateClock, 1000);
            document.getElementById('targetEmail').value = localStorage.getItem('targetEmail') || "";
        }

        function updateClock() {
            const now = new Date();
            const h = now.getHours() % 12, m = now.getMinutes(), s = now.getSeconds();
            document.getElementById('hour').style.transform = `translateX(-50%) rotate(${h * 30 + m * 0.5}deg)`;
            document.getElementById('min').style.transform = `translateX(-50%) rotate(${m * 6}deg)`;
            document.getElementById('sec').style.transform = `translateX(-50%) rotate(${s * 6}deg)`;
        }

        function askPIN(action) { targetAction = action; document.getElementById('pinOverlay').style.display = 'flex'; }
        
        function pressNum(n) {
            if (currentPIN.length < 4) {
                currentPIN += n;
                updatePinDots();
                if (currentPIN.length === 4) {
                    if (currentPIN === appPass) {
                        closePIN();
                        targetAction === 'in' ? startWork() : stopWork();
                    } else {
                        alert("Ø±Ù…Ø² PIN Ø®Ø·Ø£!");
                        clearPIN();
                    }
                }
            }
        }

        function updatePinDots() {
            const dots = document.querySelectorAll('.pin-dot');
            dots.forEach((dot, i) => dot.classList.toggle('active', i < currentPIN.length));
        }

        function clearPIN() { currentPIN = ""; updatePinDots(); }
        function closePIN() { document.getElementById('pinOverlay').style.display = 'none'; clearPIN(); }

        function startWork() {
            const now = new Date();
            window.entryTime = now;
            document.getElementById('in-time').innerText = now.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('status-display').style.opacity = '1';
            document.getElementById('inBtn').style.opacity = '0.3';
            document.getElementById('outBtn').style.opacity = '1';
            document.getElementById('out-row').style.display = 'none';
            timer = setInterval(() => {
                seconds++;
                let hh = Math.floor(seconds/3600).toString().padStart(2,'0');
                let mm = Math.floor((seconds%3600)/60).toString().padStart(2,'0');
                let ss = (seconds%60).toString().padStart(2,'0');
                document.getElementById('work-timer').innerText = `${hh}:${mm}:${ss}`;
            }, 1000);
        }

        function stopWork() {
            clearInterval(timer);
            const now = new Date();
            document.getElementById('out-time').innerText = now.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('out-row').style.display = 'flex';
            
            const logEntry = {
                date: now.toLocaleDateString('en-GB'),
                in: window.entryTime.toLocaleTimeString('en-GB'),
                out: now.toLocaleTimeString('en-GB'),
                total: (seconds/3600).toFixed(2),
                email: localStorage.getItem('targetEmail') || "guest"
            };
            
            if (navigator.onLine) fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(logEntry) });

            setTimeout(() => {
                document.getElementById('status-display').style.opacity = '0';
                document.getElementById('work-timer').innerText = "00:00:00";
                document.getElementById('inBtn').style.opacity = '1';
                document.getElementById('outBtn').style.opacity = '0.3';
                seconds = 0;
            }, 10000);
        }

        function toggleMenu() { document.getElementById('settingsMenu').classList.toggle('active'); }
        function saveEmail(v) { localStorage.setItem('targetEmail', v); }
        function changePass() {
            let p = prompt("Ø§Ø¯Ø®Ù„ PIN Ø§Ù„Ø¬Ø¯ÙŠØ¯ (4 Ø£Ø±Ù‚Ø§Ù…):");
            if (p && p.length === 4) { localStorage.setItem('appPass', p); appPass = p; alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!"); }
        }
        function openCalendar() { toggleMenu(); alert("Ø§Ù„Ø³Ø¬Ù„ Ù…Ø­ÙÙˆØ¸ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹ ÙˆÙÙŠ Ø§Ù„Ù…ØªØµÙØ­"); }
    </script>
</body>
</html>
