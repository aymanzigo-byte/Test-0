<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalWork Pro | V16 Custom Cycle</title>
    <style>
        @font-face { font-family: 'Digital'; src: url('https://fonts.cdnfonts.com/s/14234/DS-DIGI.woff') format('woff'); }
        :root { --primary: #00d2ff; --bg: #000; --card: #121212; --success: #2ecc71; --danger: #ff4b2b; --glow: #39FF14; --selection: rgba(0, 210, 255, 0.3); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; height: 100vh; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #splash { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; transition: 0.8s; }
        #splash h1 { color: var(--primary); font-size: 2.5rem; text-shadow: 0 0 20px var(--primary); }

        /* Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯ */
        .clock-container { position: relative; width: 180px; height: 180px; margin-top: 15px; border-radius: 50%; border: 3px solid #111; box-shadow: 0 0 15px rgba(0, 210, 255, 0.2); background: radial-gradient(circle, #0a0a0a 0%, #000 100%); }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; border-radius: 10px; }
        .hour-hand { width: 5px; height: 40px; background: #fff; z-index: 10; }
        .min-hand { width: 3px; height: 60px; background: var(--glow); z-index: 11; }
        .sec-hand { width: 1.5px; height: 70px; background: var(--danger); z-index: 12; }
        #work-timer { font-family: 'Digital', sans-serif; font-size: 3.5rem; color: var(--primary); margin: 10px 0; text-shadow: 0 0 15px rgba(0, 210, 255, 0.5); }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° (Modals) */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.96); display: none; justify-content: center; align-items: center; z-index: 4000; }
        .modal-box { background: var(--card); border: 1px solid #333; border-radius: 25px; padding: 20px; width: 90%; max-height: 90%; overflow-y: auto; text-align: center; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        .num-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 20px; }
        .num-btn { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 18px; border-radius: 15px; font-size: 1.4rem; font-weight: bold; cursor: pointer; }
        .num-btn:active { background: var(--primary); color: #000; }
        .pin-dot-container { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .pin-dot { width: 15px; height: 15px; border-radius: 50%; border: 2px solid var(--primary); }
        .pin-dot.active { background: var(--primary); box-shadow: 0 0 10px var(--primary); }

        /* Ø§Ù„ØªÙ‚ÙˆÙŠÙ… */
        .calendar-header { margin: 10px 0; color: var(--primary); font-weight: bold; font-size: 1.1rem; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day-btn { background: #1a1a1a; border: 1px solid #333; padding: 12px 0; border-radius: 8px; font-size: 11px; color: #fff; position: relative; }
        .day-btn.has-data::after { content: ''; position: absolute; bottom: 3px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; background: var(--success); border-radius: 50%; }
        .day-btn.selected { background: var(--selection); border-color: var(--primary); }

        /* ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ */
        .pass-input-group { margin: 10px 0; text-align: right; }
        .pass-display { background: #000; padding: 10px; border-radius: 10px; border: 1px solid #333; margin-top: 5px; height: 20px; letter-spacing: 5px; font-size: 1.2rem; color: var(--primary); text-align: center; }
        .pass-input-group.active { border: 1px solid var(--primary); }

        /* Ø§Ù„ØªØ­ÙƒÙ… */
        .controls { display: flex; gap: 30px; margin-top: auto; padding-bottom: 30px; }
        .circle-btn { width: 85px; height: 85px; border-radius: 50%; border: none; color: #fff; font-weight: bold; font-size: 14px; }
        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: #1a1a1a; border: 1px solid var(--primary); padding: 12px 25px; border-radius: 50px; z-index: 5000; transition: 0.5s; }
        #toast.show { bottom: 30px; }
        .settings-icon { position: absolute; top: 20px; left: 20px; font-size: 24px; color: #555; z-index: 2000; }
    </style>
</head>
<body onload="initApp()">

    <div id="splash"><h1>CalWork Pro</h1><p style="color:#555">V16 | ENG. AYMAN</p></div>
    <div class="settings-icon" onclick="toggleMenu()">âš™ï¸</div>

    <div id="settingsMenu" class="menu" style="position:fixed; top:-100%; width:100%; background:var(--card); transition:0.5s; padding:25px; z-index:3000; border-radius: 0 0 25px 25px; border-bottom:2px solid var(--primary)">
        <div onclick="openCalendar()" style="padding:15px; border-bottom:1px solid #222">ğŸ“… Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ø¯ÙˆØ±Ø© 26)</div>
        <div onclick="openPassModal()" style="padding:15px; border-bottom:1px solid #222">ğŸ”’ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
        <input type="email" id="targetEmail" onchange="saveEmail(this.value)" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" style="width:100%; background:#000; color:#fff; padding:10px; margin:10px 0; border-radius:8px; border:1px solid #333; text-align:center">
        <div onclick="toggleMenu()" style="padding:15px; color:var(--danger)">âœ• Ø¥ØºÙ„Ø§Ù‚</div>
    </div>

    <div class="clock-container">
        <div id="hour" class="hand hour-hand"></div><div id="min" class="hand min-hand"></div><div id="sec" class="hand sec-hand"></div><div style="position:absolute; top:50%; left:50%; width:8px; height:8px; background:#fff; border-radius:50%; transform:translate(-50%,-50%); z-index:13"></div>
    </div>

    <div id="work-timer">00:00:00</div>

    <div id="status-display" style="width:85%; opacity:0; transition:0.5s; background:rgba(255,255,255,0.03); border-radius:15px; padding:10px; border:1px dashed #333">
        <div style="display:flex; justify-content:space-between"><span id="in-time" style="color:var(--glow)">--:--</span><span>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</span></div>
        <div id="out-row" style="display:none; justify-content:space-between; margin-top:5px"><span id="out-time" style="color:var(--danger)">--:--</span><span>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</span></div>
    </div>

    <div class="controls">
        <button id="inBtn" class="circle-btn" style="background:var(--success)" onclick="askPIN('in')">IN</button>
        <button id="outBtn" class="circle-btn" style="background:var(--danger); opacity:0.3" onclick="askPIN('out')">OUT</button>
    </div>

    <div id="pinOverlay" class="overlay"><div class="modal-box">
        <h3 id="pinTitle">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h3>
        <div class="pin-dot-container"><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div></div>
        <div class="num-pad">
            <button class="num-btn" onclick="pressNum(1)">1</button><button class="num-btn" onclick="pressNum(2)">2</button><button class="num-btn" onclick="pressNum(3)">3</button>
            <button class="num-btn" onclick="pressNum(4)">4</button><button class="num-btn" onclick="pressNum(5)">5</button><button class="num-btn" onclick="pressNum(6)">6</button>
            <button class="num-btn" onclick="pressNum(7)">7</button><button class="num-btn" onclick="pressNum(8)">8</button><button class="num-btn" onclick="pressNum(9)">9</button>
            <button class="num-btn" onclick="closePIN()">âœ•</button><button class="num-btn" onclick="pressNum(0)">0</button><button class="num-btn" onclick="clearPIN()">âŒ«</button>
        </div>
    </div></div>

    <div id="passOverlay" class="overlay"><div class="modal-box">
        <h3 style="color:var(--primary)">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
        <div class="pass-input-group" id="g1"><span>Old Pass</span><div id="oldP" class="pass-display">****</div></div>
        <div class="pass-input-group" id="g2"><span>New Pass</span><div id="newP" class="pass-display">****</div></div>
        <div class="pass-input-group" id="g3"><span>Confirm New</span><div id="confP" class="pass-display">****</div></div>
        <div class="num-pad">
            <button class="num-btn" onclick="passNum(1)">1</button><button class="num-btn" onclick="passNum(2)">2</button><button class="num-btn" onclick="passNum(3)">3</button>
            <button class="num-btn" onclick="passNum(4)">4</button><button class="num-btn" onclick="passNum(5)">5</button><button class="num-btn" onclick="passNum(6)">6</button>
            <button class="num-btn" onclick="passNum(7)">7</button><button class="num-btn" onclick="passNum(8)">8</button><button class="num-btn" onclick="passNum(9)">9</button>
            <button class="num-btn" onclick="closePass()">âœ•</button><button class="num-btn" onclick="passNum(0)">0</button><button class="num-btn" onclick="clearPass()">âŒ«</button>
        </div>
    </div></div>

    <div id="logOverlay" class="overlay"><div class="modal-box">
        <h3 style="margin:0">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ</h3>
        <div id="calMonth" class="calendar-header"></div>
        <div class="calendar-grid" id="calendarGrid"></div>
        <div id="reportArea" style="margin-top:15px"></div>
        <button onclick="closeModals()" style="width:100%; padding:15px; background:var(--danger); border:none; color:#fff; border-radius:15px; margin-top:15px; font-weight:bold">Ø¥ØºÙ„Ø§Ù‚</button>
    </div></div>

    <div id="toast">âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyvmKQlFFEr5vkGe3GLCmAADIJRcGVnXWimP3NSQgNZ35SPaDzr91BV-JeJPicO0FVw/exec';
        let timer, seconds = 0, currentPIN = "", targetAction = "", appPass = localStorage.getItem('appPass') || "1234", logs = JSON.parse(localStorage.getItem('calwork_db')) || {};
        let passStep = 1, tempOld="", tempNew="", tempConf="", selectedDays=[];

        function initApp() {
            setInterval(updateClock, 1000);
            document.getElementById('targetEmail').value = localStorage.getItem('targetEmail') || "";
            setTimeout(() => { document.getElementById('splash').style.opacity='0'; setTimeout(()=>document.getElementById('splash').style.display='none', 800); }, 2500);
        }

        function updateClock() {
            const now = new Date();
            const h = now.getHours() % 12, m = now.getMinutes(), s = now.getSeconds();
            document.getElementById('hour').style.transform = `translateX(-50%) rotate(${h * 30 + m * 0.5}deg)`;
            document.getElementById('min').style.transform = `translateX(-50%) rotate(${m * 6}deg)`;
            document.getElementById('sec').style.transform = `translateX(-50%) rotate(${s * 6}deg)`;
        }

        function showToast(m) { document.getElementById('toast').innerText=m; document.getElementById('toast').classList.add('show'); setTimeout(()=>document.getElementById('toast').classList.remove('show'), 3000); }

        // Ù†Ø¸Ø§Ù… PIN Ø§Ù„Ø­Ø¶ÙˆØ±
        function askPIN(a) { targetAction=a; document.getElementById('pinOverlay').style.display='flex'; }
        function pressNum(n) { if(currentPIN.length<4){ currentPIN+=n; updateDots(); if(currentPIN.length===4) checkPIN(); } }
        function updateDots() { document.querySelectorAll('.pin-dot').forEach((d,i)=>d.classList.toggle('active', i<currentPIN.length)); }
        function checkPIN() { if(currentPIN===appPass){ closePIN(); targetAction==='in'?startWork():stopWork(); } else { showToast("âŒ PIN Ø®Ø·Ø£"); clearPIN(); } }
        function clearPIN() { currentPIN=""; updateDots(); }
        function closePIN() { document.getElementById('pinOverlay').style.display='none'; clearPIN(); }

        function startWork() {
            window.entryTime = new Date();
            document.getElementById('in-time').innerText = window.entryTime.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            document.getElementById('status-display').style.opacity='1';
            document.getElementById('inBtn').style.opacity='0.3'; document.getElementById('outBtn').style.opacity='1';
            timer = setInterval(() => { seconds++; let h=Math.floor(seconds/3600).toString().padStart(2,'0'), m=Math.floor((seconds%3600)/60).toString().padStart(2,'0'), s=(seconds%60).toString().padStart(2,'0'); document.getElementById('work-timer').innerText=`${h}:${m}:${s}`; }, 1000);
        }

        function stopWork() {
            clearInterval(timer); const now = new Date();
            document.getElementById('out-time').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            document.getElementById('out-row').style.display='flex';
            let t=(seconds/3600).toFixed(2), b=t>8?8:t, e=t>8?(t-8).toFixed(2):"0.00";
            const entry = { date: now.toLocaleDateString('en-GB'), in: window.entryTime.toLocaleTimeString('en-GB'), out: now.toLocaleTimeString('en-GB'), total: t, basic: b, extra: e };
            logs[`${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`] = entry;
            localStorage.setItem('calwork_db', JSON.stringify(logs));
            if(navigator.onLine) fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', body:JSON.stringify({...entry, email:localStorage.getItem('targetEmail')})});
            showToast("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            setTimeout(() => { document.getElementById('status-display').style.opacity='0'; document.getElementById('work-timer').innerText="00:00:00"; document.getElementById('inBtn').style.opacity='1'; document.getElementById('outBtn').style.opacity='0.3'; seconds=0; }, 10000);
        }

        // Ù†Ø¸Ø§Ù… ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù…Ø·ÙˆØ±
        function openPassModal() { toggleMenu(); document.getElementById('passOverlay').style.display='flex'; passStep=1; updatePassUI(); }
        function passNum(n) {
            if(passStep==1 && tempOld.length<4) tempOld+=n;
            else if(passStep==2 && tempNew.length<4) tempNew+=n;
            else if(passStep==3 && tempConf.length<4) tempConf+=n;
            if(tempOld.length==4 && passStep==1) passStep=2;
            if(tempNew.length==4 && passStep==2) passStep=3;
            if(tempConf.length==4 && passStep==3) finishPass();
            updatePassUI();
        }
        function updatePassUI() {
            document.getElementById('oldP').innerText = "*".repeat(tempOld.length);
            document.getElementById('newP').innerText = "*".repeat(tempNew.length);
            document.getElementById('confP').innerText = "*".repeat(tempConf.length);
            document.getElementById('g1').style.opacity = passStep==1?1:0.3;
            document.getElementById('g2').style.opacity = passStep==2?1:0.3;
            document.getElementById('g3').style.opacity = passStep==3?1:0.3;
        }
        function finishPass() {
            if(tempOld !== appPass) { showToast("âŒ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø®Ø·Ø£"); clearPass(); passStep=1; }
            else if(tempNew !== tempConf) { showToast("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ·Ø§Ø¨Ù‚"); tempNew=""; tempConf=""; passStep=2; }
            else { localStorage.setItem('appPass', tempNew); appPass=tempNew; showToast("âœ… ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±"); closePass(); }
            updatePassUI();
        }
        function clearPass() { tempOld=""; tempNew=""; tempConf=""; passStep=1; updatePassUI(); }
        function closePass() { document.getElementById('passOverlay').style.display='none'; clearPass(); }

        // Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø¯ÙˆØ±Ø© 26
        function openCalendar() {
            toggleMenu(); document.getElementById('logOverlay').style.display='flex';
            const now = new Date();
            const monthNames = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø¥Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
            document.getElementById('calMonth').innerText = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
            renderCycle();
        }
        function renderCycle() {
            const grid = document.getElementById('calendarGrid'); grid.innerHTML = "";
            const now = new Date();
            let start = new Date(now.getFullYear(), now.getMonth()-1, 26);
            let end = new Date(now.getFullYear(), now.getMonth(), 26);
            for(let d = new Date(start); d <= end; d.setDate(d.getDate()+1)) {
                let dayNum = d.getDate();
                let key = `${d.getFullYear()}-${d.getMonth()+1}-${dayNum}`;
                const btn = document.createElement('div');
                btn.className = `day-btn ${logs[key] ? 'has-data' : ''} ${selectedDays.includes(key) ? 'selected' : ''}`;
                btn.innerText = dayNum;
                let t; btn.onmousedown = btn.ontouchstart = () => t = setTimeout(()=>selectCycle(key), 600);
                btn.onmouseup = btn.ontouchend = () => clearTimeout(t);
                grid.appendChild(btn);
            }
        }
        function selectCycle(k) {
            if(selectedDays.length>=2) selectedDays=[];
            selectedDays.push(k); selectedDays.sort((a,b)=>new Date(a)-new Date(b));
            renderCycle();
            if(selectedDays.length==2) {
                let b=0, e=0;
                for(let key in logs) {
                    let d = new Date(key), s = new Date(selectedDays[0]), en = new Date(selectedDays[1]);
                    if(d>=s && d<=en) { b+=parseFloat(logs[key].basic); e+=parseFloat(logs[key].extra); }
                }
                document.getElementById('reportArea').innerHTML = `<div style="background:#1a1a1a; padding:15px; border-radius:15px; border-right:4px solid var(--primary); text-align:right">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${b.toFixed(2)} hr<br><span style="color:var(--primary)">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ: ${e.toFixed(2)} hr</span></div>`;
            }
        }

        function toggleMenu() { let m=document.getElementById('settingsMenu'); m.style.top = m.style.top==='0px'?'-100%':'0px'; }
        function saveEmail(v) { localStorage.setItem('targetEmail', v); showToast("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„"); }
        function closeModals() { document.querySelectorAll('.overlay').forEach(o=>o.style.display='none'); selectedDays=[]; document.getElementById('reportArea').innerHTML=""; }
    </script>
</body>
</html>
