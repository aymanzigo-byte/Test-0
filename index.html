<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalWork Pro | V18.2</title>
    <style>
        @font-face { font-family: 'Digital'; src: url('https://fonts.cdnfonts.com/s/14234/DS-DIGI.woff') format('woff'); }
        :root { --primary: #00d2ff; --bg: #000; --card: #121212; --success: #2ecc71; --danger: #ff4b2b; --glow: #39FF14; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; height: 100vh; }

        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª */
        #splash, #activationOverlay { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        #activationOverlay { z-index: 10000; display: none; }
        
        .act-box { background: var(--card); border: 1px solid var(--primary); padding: 30px; border-radius: 25px; width: 85%; text-align: center; }
        .act-input { background: #000; border: 1px solid #333; color: var(--primary); padding: 15px; border-radius: 12px; width: 100%; margin: 20px 0; text-align: center; font-size: 1.5rem; box-sizing: border-box; }
        .act-btn { background: var(--primary); color: #000; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: bold; }

        .settings-icon { position: absolute; top: 20px; left: 20px; font-size: 26px; color: #555; z-index: 2000; cursor: pointer; }
        .side-menu { position: fixed; top: -100%; left: 0; width: 100%; background: var(--card); transition: 0.5s; padding: 25px; z-index: 3000; border-bottom: 2px solid var(--primary); border-radius: 0 0 25px 25px; box-sizing: border-box; }
        .side-menu.active { top: 0; }

        /* Ø§Ù„Ø³Ø§Ø¹Ø© */
        .clock-container { position: relative; width: 200px; height: 200px; margin-top: 20px; border-radius: 50%; border: 2px solid #222; background: radial-gradient(circle, #0a0a0a 0%, #000 100%); }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; border-radius: 10px; }
        .hour-hand { width: 6px; height: 45px; background: #fff; z-index: 10; }
        .min-hand { width: 4px; height: 65px; background: var(--glow); z-index: 11; }
        .sec-hand { width: 2px; height: 75px; background: var(--danger); z-index: 12; }
        .clock-num { position: absolute; width: 100%; height: 100%; text-align: center; font-weight: bold; font-size: 15px; color: var(--primary); padding: 5px; box-sizing: border-box; }

        #work-timer { font-family: 'Digital', sans-serif; font-size: 4rem; color: var(--primary); margin: 15px 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.97); display: none; justify-content: center; align-items: center; z-index: 4000; }
        .modal-box { background: var(--card); border: 1px solid #333; border-radius: 25px; padding: 20px; width: 90%; text-align: center; }
        .num-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 15px; }
        .num-btn { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 18px; border-radius: 15px; font-size: 1.4rem; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; }
        .day-btn { background: #1a1a1a; border: 1px solid #333; padding: 10px 0; border-radius: 8px; font-size: 11px; }
        .day-btn.has-data { border-color: var(--success); }
        
        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: #1a1a1a; border: 1px solid var(--primary); padding: 12px 25px; border-radius: 50px; z-index: 5000; transition: 0.5s; }
        #toast.show { bottom: 30px; }
    </style>
</head>
<body onload="initApp()">

    <div id="splash">
        <h1 style="color:var(--primary)">CalWork Pro</h1>
        <div style="color:#555">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <div id="activationOverlay">
        <div class="act-box">
            <h2 style="color:var(--primary)">ØªÙ†Ø´ÙŠØ· Ø§Ù„Ù†Ø³Ø®Ø©</h2>
            <input type="text" id="activationKeyInput" class="act-input" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„">
            <button class="act-btn" onclick="checkActivation()">ØªÙ†Ø´ÙŠØ·</button>
            <p id="actError" style="color:var(--danger); display:none">âŒ ÙƒÙˆØ¯ Ø®Ø·Ø£</p>
        </div>
    </div>

    <div class="settings-icon" onclick="toggleMenu()">âš™ï¸</div>

    <div id="sideMenu" class="side-menu">
        <div onclick="openCalendar()" style="padding:15px; border-bottom:1px solid #222">ğŸ“… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</div>
        <input type="email" id="targetEmail" onchange="localStorage.setItem('targetEmail', this.value)" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" style="width:100%; background:#000; color:#fff; padding:10px; margin:10px 0; border:1px solid #333; text-align:center">
        <div style="border-top:1px solid #333; padding-top:10px">
            <label style="font-size:10px; color:var(--primary)">ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
            <input type="text" id="masterKeyInput" onchange="updateActivationKey(this.value)" style="width:100%; background:#000; color:#fff; padding:8px; border:1px dashed var(--primary); text-align:center">
        </div>
        <div onclick="toggleMenu()" style="padding:15px; color:var(--danger)">âœ• Ø¥ØºÙ„Ø§Ù‚</div>
    </div>

    <div class="clock-container" id="analogClock">
        <div id="hour" class="hand hour-hand"></div>
        <div id="min" class="hand min-hand"></div>
        <div id="sec" class="hand sec-hand"></div>
    </div>

    <div id="work-timer">00:00:00</div>

    <div id="status-display" style="width:85%; opacity:0;">
        <div style="display:flex; justify-content:space-between"><span id="in-time" style="color:var(--glow)">--:--</span><span>Ø§Ù„Ø­Ø¶ÙˆØ±</span></div>
        <div id="out-row" style="display:none; justify-content:space-between"><span id="out-time" style="color:var(--danger)">--:--</span><span>Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</span></div>
    </div>

    <div style="display:flex; gap:30px; margin-top:auto; padding-bottom:40px">
        <button id="inBtn" style="width:80px; height:80px; border-radius:50%; background:var(--success); color:#fff;" onclick="askPIN('in')">IN</button>
        <button id="outBtn" style="width:80px; height:80px; border-radius:50%; background:var(--danger); color:#fff; opacity:0.3" onclick="askPIN('out')">OUT</button>
    </div>

    <div id="pinOverlay" class="overlay"><div class="modal-box">
        <h3>PIN</h3>
        <div id="pinDots" style="font-size:2rem; color:var(--primary); margin:10px;"></div>
        <div class="num-pad">
            <button class="num-btn" onclick="pressNum(1)">1</button><button class="num-btn" onclick="pressNum(2)">2</button><button class="num-btn" onclick="pressNum(3)">3</button>
            <button class="num-btn" onclick="pressNum(4)">4</button><button class="num-btn" onclick="pressNum(5)">5</button><button class="num-btn" onclick="pressNum(6)">6</button>
            <button class="num-btn" onclick="pressNum(7)">7</button><button class="num-btn" onclick="pressNum(8)">8</button><button class="num-btn" onclick="pressNum(9)">9</button>
            <button class="num-btn" onclick="closeModals()">âœ•</button><button class="num-btn" onclick="pressNum(0)">0</button><button class="num-btn" onclick="currentPIN=''">âŒ«</button>
        </div>
    </div></div>

    <div id="logOverlay" class="overlay"><div class="modal-box">
        <h3 id="calHeader"></h3>
        <div class="calendar-grid" id="grid"></div>
        <div id="dayInfo" style="margin-top:10px; color:#aaa"></div>
        <button onclick="closeModals()" style="width:100%; padding:10px; background:var(--danger); border:none; color:#fff; border-radius:10px; margin-top:10px">Ø¥ØºÙ„Ø§Ù‚</button>
    </div></div>

    <div id="toast"></div>

    <script>
    let timer, seconds=0, currentPIN="", targetAction="", appPass=localStorage.getItem('appPass')||"1234";
    let logs=JSON.parse(localStorage.getItem('calwork_db'))||{};
    let masterKey = localStorage.getItem('masterActivationKey') || "2026";

    function initApp() {
    try {
        // 1. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø© ÙÙˆØ±Ø§Ù‹ (Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±Ø¨ Ù…ØªÙ‚ÙØ´)
        createClockNumbers();
        setInterval(updateClock, 1000);

        // 2. ÙØ­Øµ Ø§Ù„ØªÙØ¹ÙŠÙ„
        if (!localStorage.getItem('isActivated')) {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('activationOverlay').style.display = 'flex';
            return; 
        }

        // 3. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        document.getElementById('targetEmail').value = localStorage.getItem('targetEmail') || "";
        if(document.getElementById('masterKeyInput')) {
            document.getElementById('masterKeyInput').value = masterKey;
        }

        // 4. ÙØ­Øµ Ù„Ùˆ ÙÙŠÙ‡ Ø¹Ø¯Ø§Ø¯ Ø´ØºØ§Ù„
        const savedTime = localStorage.getItem('isWorkingTime');
        if (savedTime) {
            window.entryTime = new Date(savedTime);
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† Ø¯Ù„ÙˆÙ‚ØªÙŠ ÙˆØ¨ÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±
            seconds = Math.floor((new Date() - window.entryTime) / 1000);
            resumeTimer();
        }

    } catch (e) {
        console.log("Error in init:", e);
    } finally {
        // 5. Ø£Ù‡Ù… Ø³Ø·Ø±: Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆÙ†ØµÙ Ù…Ù‡Ù…Ø§ Ø­ØµÙ„
        setTimeout(() => { 
            const splash = document.getElementById('splash');
            if(splash) splash.style.display = 'none'; 
        }, 1500);
    }
}

    function createClockNumbers() {
        const c = document.getElementById('analogClock');
        for(let i=1; i<=12; i++) {
            let d = document.createElement('div');
            d.className = 'clock-num'; d.innerText = i;
            d.style.transform = `rotate(${i*30}deg)`;
            c.appendChild(d);
        }
    }

    function updateClock() {
        const n = new Date();
        const h=n.getHours()%12, m=n.getMinutes(), s=n.getSeconds();
        document.getElementById('hour').style.transform=`translateX(-50%) rotate(${h*30+m*0.5}deg)`;
        document.getElementById('min').style.transform=`translateX(-50%) rotate(${m*6}deg)`;
        document.getElementById('sec').style.transform=`translateX(-50%) rotate(${s*6}deg)`;
    }

    function checkActivation() {
        if (document.getElementById('activationKeyInput').value === masterKey) {
            localStorage.setItem('isActivated', 'true');
            location.reload();
        } else {
            document.getElementById('actError').style.display = 'block';
        }
    }

    function updateActivationKey(v) {
        localStorage.setItem('masterActivationKey', v);
        masterKey = v;
        showToast("âœ… ÙƒÙˆØ¯ Ø§Ù„ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯: " + v);
    }

    function askPIN(a) { targetAction=a; document.getElementById('pinOverlay').style.display='flex'; }
    
    function pressNum(n) { 
        if(currentPIN.length < 4) {
            currentPIN += n;
            document.getElementById('pinDots').innerText = "*".repeat(currentPIN.length);
            if(currentPIN.length === 4) {
                if(currentPIN === appPass) {
                    closeModals();
                    targetAction === 'in' ? startWork() : stopWork();
                } else {
                    showToast("âŒ PIN Ø®Ø·Ø£");
                    currentPIN = ""; document.getElementById('pinDots').innerText = "";
                }
            }
        }
    }

    function startWork() {
        window.entryTime = new Date();
        localStorage.setItem('isWorkingTime', window.entryTime);
        resumeTimer();
    }

    function resumeTimer() {
        document.getElementById('in-time').innerText = window.entryTime.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        document.getElementById('status-display').style.opacity='1';
        document.getElementById('inBtn').style.opacity='0.3'; document.getElementById('outBtn').style.opacity='1';
        if(timer) clearInterval(timer);
        timer = setInterval(updateTimerDisplay, 1000);
    }

    function updateTimerDisplay() {
    seconds++;
    let h = Math.floor(seconds / 3600).toString().padStart(2, '0');
    let m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
    let s = (seconds % 60).toString().padStart(2, '0');
    const timerElem = document.getElementById('work-timer');
    if(timerElem) timerElem.innerText = `${h}:${m}:${s}`;
}

function resumeTimer() {
    const inTimeElem = document.getElementById('in-time');
    if(inTimeElem) inTimeElem.innerText = window.entryTime.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    
    document.getElementById('status-display').style.opacity = '1';
    document.getElementById('inBtn').style.opacity = '0.3'; 
    document.getElementById('outBtn').style.opacity = '1';
    
    if(timer) clearInterval(timer);
    timer = setInterval(updateTimerDisplay, 1000);
}

    function stopWork() {
    clearInterval(timer);
    const now = new Date();
    localStorage.removeItem('isWorkingTime');
    
    let totalHours = (seconds / 3600).toFixed(2);
    const key = `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
    
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
    logs[key] = { 
        in: window.entryTime.toLocaleTimeString(), 
        out: now.toLocaleTimeString(), 
        total: totalHours 
    };
    localStorage.setItem('calwork_db', JSON.stringify(logs));
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹ Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
    sendToGoogleSheet(window.entryTime, now, totalHours);
    
    showToast("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    setTimeout(() => location.reload(), 3000);
}

    function showToast(m) { 
        const t = document.getElementById('toast'); t.innerText = m; 
        t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); 
    }
    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); }
    function closeModals() { document.querySelectorAll('.overlay').forEach(o=>o.style.display='none'); currentPIN=""; document.getElementById('pinDots').innerText=""; }
    function openCalendar() { toggleMenu(); document.getElementById('logOverlay').style.display='flex'; renderCycle(); }

    function renderCycle() {
        const grid = document.getElementById('grid'); grid.innerHTML = "";
        const now = new Date();
        document.getElementById('calHeader').innerText = `Ø³Ø¬Ù„ ${now.getMonth()+1} / ${now.getFullYear()}`;
        let start = new Date(now.getFullYear(), now.getMonth(), 1);
        for(let i=0; i<31; i++) {
            let d = new Date(start); d.setDate(i+1);
            if(d.getMonth() !== now.getMonth()) break;
            const btn = document.createElement('div');
            btn.className = 'day-btn';
            btn.innerText = d.getDate();
            const log = logs[`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`];
            if(log) btn.classList.add('has-data');
            btn.onclick = () => {
                document.getElementById('dayInfo').innerText = log ? `Ø­Ø¶ÙˆØ±: ${log.in} | Ø§Ù†ØµØ±Ø§Ù: ${log.out} | Ø³Ø¹Ø§Øª: ${log.total}` : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";
            };
            grid.appendChild(btn);
        }
    }
        function sendToGoogleSheet(inDate, outDate, hours) {
    const url = "https://script.google.com/macros/s/AKfycby_VSe2_iS2EX4pNjDE15Bw8cbmL6D4BTQkmsB1yl_wzUcAGcyOB2E8AUalGfjpmCpu/exec"; // Ø¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
    const data = {
        date: inDate.toLocaleDateString(),
        in: inDate.toLocaleTimeString(),
        out: outDate.toLocaleTimeString(),
        duration: hours,
        email: document.getElementById('targetEmail').value
    };

    fetch(url, {
        method: "POST",
        mode: "no-cors",
        cache: "no-cache",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(() => console.log("Data sent to Google Sheets"))
    .catch(err => console.error("Error sending data:", err));
}
    </script>
</body>
</html>


